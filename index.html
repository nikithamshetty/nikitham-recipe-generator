<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SMART CULINARY ASSISTANT üç≥‚ú®</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0; min-height: 100vh; background: linear-gradient(120deg, #fbc2eb 0%, #a6c1ee 100%);
            font-family: 'Quicksand', 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center;
        }
        .glass-card {
            background: rgba(255,255,255,0.68);
            backdrop-filter: blur(12px);
            margin: 50px 0 20px;
            border-radius: 24px;
            width: 95%; max-width: 520px;
            box-shadow: 0px 12px 36px #7056a72b;
            padding: 40px 30px 30px;
            position: relative;
        }
        .glass-card h2 {
            text-align: center;
            color: #5a2a8f;
            font-size: 2rem;
            margin-bottom: 20px;
        }
        .input-section { margin-bottom: 18px; }
        label {
            font-size: 1.09em; color: #5a4083; margin-bottom: 6px; display: block;
        }
        .chips {
            display: flex; flex-wrap: wrap; margin-bottom: 12px; gap: 7px;
        }
        .chip {
            background: #f5e7ff; color: #834da6;
            padding: 7px 13px; font-size: 1em;
            border-radius: 18px; margin-right: 4px;
            display: flex; align-items: center;
            box-shadow: 0 1px 4px #d0bae9b3;
        }
        .chip .remove-chip { margin-left: 6px; cursor: pointer; }
        #ingredientInput { font-size: 15px; border: none; outline: none; border-bottom: 2px solid #c99cff; background: transparent; width: 260px; }
        #special { width: 100%; margin-bottom:16px; border-radius: 8px; border: 1px solid #caaceb; padding: 9px }
        button {
            background: linear-gradient(to right, #ae71ff, #71e2f4);
            color: #fff; padding: 11px 32px; border-radius: 8px; border: none;
            font-size: 1.19em; cursor: pointer; box-shadow: 0 3px 16px #dad6f7;
            transition: background .22s;
            margin-top: 7px;
        }
        button:active { background: linear-gradient(to right, #7e51f1, #63bcd3);}
        .loader {
            margin: 24px auto 8px; width: 32px; text-align: center;
        }
        .loader > div {
            width: 8px; height: 8px; background: #8659f0; border-radius: 100%; display: inline-block;
            animation: bouncedelay 1.2s infinite ease-in-out both;
        }
        .loader .bounce1 { animation-delay: -0.32s }
        .loader .bounce2 { animation-delay: -0.16s }
        @keyframes bouncedelay {
          0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); }
        }
        .result {
            animation: fadeIn .8s; margin-top: 27px; background: #fff7fbf2;
            padding: 19px 16px; border-radius: 14px;
            box-shadow: 0 2px 8px #eabdf560;
        }
        @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
        .result img {
            max-width: 98%; display: block; margin: 0 auto 22px; border-radius: 13px; box-shadow: 0 2px 14px #e0d2fe66;
        }
        .footer {
            text-align: center; color: #a285cb; margin-top: 7px; font-size: 0.97em;
        }
        @media (max-width: 600px) {
            .glass-card { padding: 16px 2vw 12px; }
            .result { font-size: 0.99em; }
        }
    </style>
</head>
<body>
  <div class="glass-card">
    <h2>
      <span style="font-size:1.1em"></span> SMART CULINARY ASSISTANT <span style="font-size:1.2em">‚ú®</span>
    </h2>
    <div class="input-section">
        <label>Ingredients (type & press ‚ÄòEnter‚Äô):</label>
        <div class="chips" id="chips"></div>
        <input id="ingredientInput" type="text" autocomplete="off" placeholder="e.g. tomatoes" />
    </div>
    <label>Special Request <span style="color:#aab">(optional)</span>:</label>
    <input type="text" id="special" placeholder="e.g. vegan, spicy, gluten-free" />
    <button id="submitBtn" type="button">Generate Recipe</button>
    <div class="loader" id="loading" style="display:none;">
      <div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div>
    </div>
    <div class="result" id="output" style="display:none"></div>
  </div>
  <div class="footer">
    Made with ‚ù§Ô∏è using Gemini & HuggingFace APIs.<br>
  </div>
  <script>
    // ============ Ingredient Chip Logic =============
    let ingredients = [];
    const chipsDiv = document.getElementById('chips');
    const input = document.getElementById('ingredientInput');
    input.addEventListener('keydown', function(e){
      if ((e.key === "Enter" || e.key === ",") && input.value.trim() !== "") {
        e.preventDefault();
        addIngredient(input.value.trim());
        input.value = "";
      }
    });
    function addIngredient(val) {
      if(!val) return;
      ingredients.push(val);
      updateChips();
    }
    function removeIngredient(idx) {
      ingredients.splice(idx,1); updateChips();
    }
    function updateChips() {
      chipsDiv.innerHTML = "";
      ingredients.forEach((ing, idx) => {
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.innerHTML = `${ing}<span class="remove-chip" title="Remove">&times;</span>`;
        chip.querySelector('.remove-chip').onclick = ()=>removeIngredient(idx);
        chipsDiv.appendChild(chip);
      });
    }

    // ============ Generate Button logic (Calls Gemini & Image API) ============
    const special = document.getElementById('special');
    const btn = document.getElementById('submitBtn');
    const outputDiv = document.getElementById('output');
    const loading = document.getElementById('loading');

    // TODO: Insert your API key(s)! Do not deploy exposed.
    const GEMINI_API_KEY = "your_gemini_api_key_here";
    const HF_API_KEY = "your_huggingface_api_key_here";

    btn.onclick = async function() {
      if (!ingredients.length) { alert("Add at least one ingredient."); return; }
      outputDiv.style.display = "none";
      loading.style.display = "block";
      btn.disabled = true;
      let prompt = `You are a creative chef. Suggest a recipe using ONLY: ${ingredients.join(', ')}.`;
      if (special.value.trim())
        prompt += ` Fulfill this request: "${special.value.trim()}".`;
      prompt += ` Name the recipe. List the ingredients, then give step-by-step cooking instructions.`;

      let recipeText = "(error)";
      let recipeTitle = "Dish";
      let imgUrl = "";

      try {
        // Gemini text call
        const gemBody = { contents: [ { parts: [ { text: prompt } ] } ] };
        const gRes = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + GEMINI_API_KEY,
          { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(gemBody) }
        );
        const gData = await gRes.json();
        if (gData.candidates && gData.candidates[0] && gData.candidates[0].content && gData.candidates[0].content.parts[0].text) {
          recipeText = gData.candidates[0].content.parts[0].text;
          // Try to extract title for the prompt
          recipeTitle = (recipeText.split('\n')[0] || "Dish").replace(/Recipe:|Name:/i,"").trim();
        } else throw new Error("AI error");

        // HuggingFace image call (Stable Diffusion style)
        const imgPrompt = `A high quality, realistic, bright food photo of: ${recipeTitle}. Styled for a recipe website.`;
        const imgRes = await fetch("https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-2", {
            method: "POST",
            headers: {
                "Authorization": "Bearer " + HF_API_KEY,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ inputs: imgPrompt })
        });
        const imgBlob = await imgRes.blob();
        imgUrl = URL.createObjectURL(imgBlob);
        
        // Display
        outputDiv.style.display = "block";
        outputDiv.innerHTML = `<img src="${imgUrl}" alt="Recipe Image">
            <div class="textResp">${recipeText.replace(/\n/g,"<br>")}</div>`;
      } catch(err) {
        outputDiv.style.display = "block";
        outputDiv.innerHTML = "Failed: "+err.message+"<br><br>"+recipeText.replace(/\n/g,"<br>");
      } finally {
        loading.style.display = "none";
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
